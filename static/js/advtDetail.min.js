let recentItem,debounceTimer,nowDate=moment().format("YYYYMMDDTHHmm"),adventureName="",apioff=!1,setList={};function openTab(e){const a=document.querySelectorAll(".tab"),t=document.querySelectorAll(".tab-content");a.forEach(e=>e.classList.remove("active")),t.forEach(e=>e.classList.remove("active")),document.querySelector(`[onclick="openTab('${e}')"]`).classList.add("active"),document.getElementById(e).classList.add("active")}function filterSpan(e,a){e.children().each(function(){const e=$(this),t=$(this).text();""===a||t.includes(a)?e.css("display",""):e.hide()}),e.offsetWidth}function Search(){if(apioff||"0"===sessionStorage.getItem("serverState"))return toast("warning","DFGEAR 서버 점검");nowDate=moment().subtract(1,"m").format("YYYYMMDDTHHmm"),loadingToggle(),$("#mistList > div").remove(),adventureDetail(function(e,a){try{if(sessionStorage.clear(),timeLineList=[],a){if(loadingToggle(!1),!e.responseText)return console.log(a),console.log(e),alert("에러 발생");checkError(e.responseText)}else{if(e.error)return loadingToggle(!1),$(".resultData").removeClass("show"),"APIKEY_AUTH_ERROR"==e.error.message?toast("danger","에러 발생_APIKEY오류"):"SYSTEM_INSPECT"==e.error.message?(apioff=!0,toast("danger","DNF점검")):(console.log(e),toast("danger","에러 발생_캐릭터정보오류"));if(!(e.rows.length>0))return loadingToggle(!1),$(".resultData").removeClass("show"),alert("모험단 상세정보를 불러오는데 실패했습니다.");data_List(e),set_List(e)}}catch(e){return sessionStorage.clear(),console.error(e),loadingToggle(!1),$(".resultData").removeClass("show"),$("#mistList > div").remove(),"NO_CHARACTER"===e?toast("danger","일치하는 캐릭터 정보가 없습니다"):"NOT_FOUND_CHARACTER"===e?toast("danger","캐릭터 정보를 찾을 수 없습니다"):alert("에러 발생")}})}function loadingToggle(e=!0){e?($("#loadingScreen").css("height",$(document).height()),$("#loadingScreen").addClass("active"),$("#btn_search").addClass("disabled")):($("#loadingScreen").removeClass("active"),$("#btn_search").removeClass("disabled"))}function makeCardView(e){try{$(".characterView").html(""),characterId=e.characterId,$(".characterView").attr("data-cId",e.characterId),$(".characterView").attr("data-sId",e.serverId);let a=`<span class="famehigh">명성이 가장 높은 캐릭터</span><img src="https://img-api.neople.co.kr/df/servers/${e.serverId}/characters/${e.characterId}/" class="card-img-top" alt="...">\n      <div class="card-body"><div class="flex flex-row gap-1 items-center ho-c"><img class="g-chimg" src="./static/images/fame.png"><div class="fameNumber">${e.fame}</div></div>  \n       <span id="cName" class="card-text uselct">${e.characterName}</span>          \n          <div style="text-align: -webkit-center"><p id="aName" class="card-text uselct" style="width:max-content;margin-bottom: 1rem !important;">${e.adventureName}</p></div>`;a+=`<span class="card-text uselct">태초 획득 : ${e.begin}</span>\n          <span class="card-text uselct">에픽 획득 : ${e.epic}</span>          \n          <span class="card-text uselct">레전더리 획득 : ${e.legnd}</span>\n          <span class="card-text uselct mb-1">심연:숭배자 : ${e.abyss?e.abyss:"-"}</span>\n          <span class="card-text uselct mb-2 potCount ${e.potBegin+e.potEpic+e.potLegnd>0?"show":""}">항아리 : <span class="r_begin">${e.potBegin}</span> / <span class="r_epic">${e.potEpic}</span> / <span class="r_legnd">${e.potLegnd}</span></span>\n          <span class="card-text small">최근 업데이트</span>\n          <span class="card-text small mb-1">${moment(e.updatedAt).format("YYYY-MM-DD HH:mm:ss")}</span>\n          <a href="https://dundam.xyz/character?server=${e.serverId}&key=${e.characterId}" target="_blank"><img src="https://dundam.xyz/007.png" alt="던담 바로가기" style="height:2.375rem; border-radius: 0.5em;"/></a>\n        </div>`,$(".characterView").append(a)}catch(e){console.log(e)}}function data_List(e){$("#advName").text(e.adventureName);let a='<div class="card-header legacy">태거시 리스트</div><ul class="list-group list-group-flush">',t='<div class="card-header begin">태초 리스트</div><ul class="list-group list-group-flush">',s="",n="",d={legacy:0,begin:0,epic:0,legnd:0,pot:0,cardLB:0,cardB:0,potLB:0,potB:0,transB:0,transLB:0,potEpic:0,potLegnd:0,abyss:0};try{e.timeline.forEach((a,n)=>{let i="",l="",r="";if(a.sp&&(i="abyss"),a.advtIn&&"in"==a.advtIn?(l="advt-in",r=' <span class="badge bg-warning rounded-pill">초월보냄</span>'):504==a.code?r=' <span class="badge bg-warning rounded-pill dv-list">항아리&상자</span>':507==a.code?r=` <span class="badge bg-warning rounded-pill" title="${a.channel}">레이드</span>`:510==a.code?r=' <span class="badge bg-warning rounded-pill">교환</span>':511==a.code?r=' <span class="badge bg-warning rounded-pill">승급</span>':513==a.code?r=` <span class="badge bg-warning rounded-pill" title="${a.channel}">카드</span>`:514==a.code?r=' <span class="badge bg-warning rounded-pill">리롤/제작서</span>':515==a.code||516==a.code?r=` <span class="badge bg-warning rounded-pill" title="${a.channel}">초월</span>`:519==a.code?r=' <span class="badge bg-warning rounded-pill">변환</span>':520==a.code&&(r=' <span class="badge bg-warning rounded-pill">제작</span>'),"태초"==a.itemRarity)if(null==a.itemType||0==e.legacy.length)515==a.code||516==a.code?(d.transB++,s+=`<li class="list-group-item dv-list ${i}" title="${moment(a.date).format("YYYY-MM-DD HH:mm")}">\n            <dd>-</dd>\n            <div class="smallIcon ${a.jobCss}" style="background-image: url('https://img-api.neople.co.kr/df/servers/${a.serverId}/characters/${a.characterId}?zoom=1');"></div>\n            <p class="${l}" tabindex="0" data-title="${moment(a.date).format("YYYY-MM-DD HH:mm")}"><img src="https://img-api.neople.co.kr/df/items/${a.itemId}">${a.itemName}</p>\n            <span class="badge bg-warning rounded-pill" title="${a.channel}">초월</span></li>`):504==a.code?(d.begin++,d.potB++,t+=`<li class="list-group-item ${i}" title="${moment(a.date).format("YYYY-MM-DD HH:mm")}">\n            <dd class="dv-list">-</dd><dd class="dv-pot hidden">${d.potB}</dd>\n            <div class="smallIcon ${a.jobCss}" style="background-image: url('https://img-api.neople.co.kr/df/servers/${a.serverId}/characters/${a.characterId}?zoom=1');"></div>\n            <p class="${l}" tabindex="0" data-title="${moment(a.date).format("YYYY-MM-DD HH:mm")}${505!=a.code?", "+a.channel:""}"><img src="https://img-api.neople.co.kr/df/items/${a.itemId}">${a.itemName}</p>`,t+=r,t+="</li>"):(d.begin++,507!=a.code&&513!=a.code||d.cardB++,t+=`<li class="list-group-item dv-list ${i}" title="${moment(a.date).format("YYYY-MM-DD HH:mm")}">\n            <dd>${d.begin-d.potB}</dd>\n            <div class="smallIcon ${a.jobCss}" style="background-image: url('https://img-api.neople.co.kr/df/servers/${a.serverId}/characters/${a.characterId}?zoom=1');"></div>\n            <p class="${l}" tabindex="0" data-title="${moment(a.date).format("YYYY-MM-DD HH:mm")}${505!=a.code?", "+a.channel:""}"><img src="https://img-api.neople.co.kr/df/items/${a.itemId}">${a.itemName}</p>`,t+=r,t+="</li>");else{let n;for(leg of e.legacy)if(a.characterId==leg.characterId&&a.itemName==leg.itemName){n=leg;break}null==n&&(515==a.code||516==a.code?(d.transB++,s+=`<li class="list-group-item dv-list ${i}" title="${moment(a.date).format("YYYY-MM-DD HH:mm")}">\n              <dd>-</dd>\n              <div class="smallIcon ${a.jobCss}" style="background-image: url('https://img-api.neople.co.kr/df/servers/${a.serverId}/characters/${a.characterId}?zoom=1');"></div>\n              <p class="${l}" tabindex="0" data-title="${moment(a.date).format("YYYY-MM-DD HH:mm")}${505!=a.code?", "+a.channel:""}"><img src="https://img-api.neople.co.kr/df/items/${a.itemId}">${a.itemName}</p>\n              <span class="badge bg-warning rounded-pill" title="${a.channel}">초월</span></li>`):504==a.code?(d.begin++,d.potB++,t+=`<li class="list-group-item ${i}" title="${moment(a.date).format("YYYY-MM-DD HH:mm")}">\n              <dd class="dv-list">-</dd><dd class="dv-pot hidden">${d.potB}</dd>\n              <div class="smallIcon ${a.jobCss}" style="background-image: url('https://img-api.neople.co.kr/df/servers/${a.serverId}/characters/${a.characterId}?zoom=1');"></div>\n              <p class="${l}" tabindex="0" data-title="${moment(a.date).format("YYYY-MM-DD HH:mm")}${505!=a.code?", "+a.channel:""}"><img src="https://img-api.neople.co.kr/df/items/${a.itemId}">${a.itemName}</p>`,t+=r,t+="</li>"):(d.begin++,507!=a.code&&513!=a.code||d.cardB++,t+=`<li class="list-group-item dv-list ${i}" title="${moment(a.date).format("YYYY-MM-DD HH:mm")}">\n              <dd>${504==a.code?"-":d.begin-d.potB}</dd>\n              <div class="smallIcon ${a.jobCss}" style="background-image: url('https://img-api.neople.co.kr/df/servers/${a.serverId}/characters/${a.characterId}?zoom=1');"></div>\n              <p class="${l}" tabindex="0" data-title="${moment(a.date).format("YYYY-MM-DD HH:mm")}${505!=a.code?", "+a.channel:""}"><img src="https://img-api.neople.co.kr/df/items/${a.itemId}">${a.itemName}</p>`,t+=r,t+="</li>"))}}),e.legacy.forEach((e,t)=>{if(null!=e.itemType){let t="",s="",i="";e.sp&&(t="abyss"),e.advtIn?(s="advt-in",i=' <span class="badge bg-warning rounded-pill">초월보냄</span>'):504==e.code?i=' <span class="badge bg-warning rounded-pill dv-list">항아리&상자</span>':507==e.code?i=` <span class="badge bg-warning rounded-pill" title="${e.channel}">레이드</span>`:510==e.code?i=' <span class="badge bg-warning rounded-pill">교환</span>':511==e.code?i=' <span class="badge bg-warning rounded-pill">승급</span>':513==e.code?i=` <span class="badge bg-warning rounded-pill" title="${e.channel}">카드</span>`:514==e.code?i=' <span class="badge bg-warning rounded-pill">리롤/제작서</span>':515==e.code||516==e.code?i=` <span class="badge bg-warning rounded-pill" title="${e.channel}">초월</span>`:519==e.code?i=' <span class="badge bg-warning rounded-pill">변환</span>':520==e.code&&(i=' <span class="badge bg-warning rounded-pill">제작</span>'),515==e.code||516==e.code?(d.transLB++,n+=`<li class="list-group-item dv-list ${t}" title="${moment(e.date).format("YYYY-MM-DD HH:mm")}">\n          <dd>-</dd>\n          <div class="smallIcon ${e.jobCss}" style="background-image: url('https://img-api.neople.co.kr/df/servers/${e.serverId}/characters/${e.characterId}?zoom=1');"></div>\n          <p class="${s}" tabindex="0" data-title="${moment(e.date).format("YYYY-MM-DD HH:mm")}"><img src="https://img-api.neople.co.kr/df/items/${e.itemId}">${e.itemName}</p>\n          <span class="badge bg-warning rounded-pill" title="${e.channel}">초월</span></li>`):504==e.code?(d.legacy++,d.potLB++,a+=`<li class="list-group-item ${t}" title="${moment(e.date).format("YYYY-MM-DD HH:mm")}">\n          <dd class="dv-list">-</dd><dd class="dv-pot hidden">${d.potLB}</dd>\n          <div class="smallIcon ${e.jobCss}" style="background-image: url('https://img-api.neople.co.kr/df/servers/${e.serverId}/characters/${e.characterId}?zoom=1');"></div>\n          <p class="${s}" tabindex="0" data-title="${moment(e.date).format("YYYY-MM-DD HH:mm")}${505!=e.code?", "+e.channel:""}"><img src="https://img-api.neople.co.kr/df/items/${e.itemId}">${e.itemName}</p>`,a+=i,a+="</li>"):(d.legacy++,507!=e.code&&513!=e.code||d.cardLB++,a+=`<li class="list-group-item dv-list ${t}" title="${moment(e.date).format("YYYY-MM-DD HH:mm")}">\n          <dd>${d.legacy}</dd>\n          <div class="smallIcon ${e.jobCss}" style="background-image: url('https://img-api.neople.co.kr/df/servers/${e.serverId}/characters/${e.characterId}?zoom=1');"></div>\n          <p class="${s}" tabindex="0" data-title="${moment(e.date).format("YYYY-MM-DD HH:mm")}${505!=e.code?", "+e.channel:""}"><img src="https://img-api.neople.co.kr/df/items/${e.itemId}">${e.itemName}</p>`,a+=i,a+="</li>")}}),timeLineList=e.timeline,d.begin+d.transB>0?(s.length>0&&(t+=s),t+="</ul>"):t+='<li class="list-group-item"> 나만 운없어 </li></ul>',d.legacy+d.transLB>0&&(n.length>0&&(a+=n),a+="</ul>",$("#mistList").append(a)),$("#mistList").append(t),e.reroll&&e.reroll.length>0&&viewList("mistList",e.reroll,"리롤 리스트","potList"),$(".resultData").addClass("show");let l={begin:0};if(""!=e.summary&&void 0!==e.summary.legnd?(d.epic=e.summary.epic,d.legnd=e.summary.legnd,d.potEpic=e.summary.potEpic,d.potLegnd=e.summary.potLegnd,d.abyss=e.summary.abyss,l=e.summary.many):e.rows.forEach(e=>{d.epic+=e.epic,d.legnd+=e.legnd,d.potEpic+=e.potEpic,d.potLegnd+=e.potLegnd,d.abyss+=e.abyss,e.begin>l.begin&&(l=e)}),$("#totalB").text(d.begin+d.legacy-d.potB-d.potLB),$("#dropB").text(`드랍:${d.begin+d.legacy-d.cardB-d.cardLB-d.potB-d.potLB}개`),$("#cardB").text(`카드:${d.cardB+d.cardLB}개`),$("#potB").text(`항아리:${d.potB+d.potLB}개`),$("#transB").text(`초월:${d.transB+d.transLB}개`),$("#totalE").text(d.epic),$("#totalL").text(d.legnd),$("#totalPe").text(d.potEpic),$("#totalPl").text(d.potLegnd),$("#totalAbyss").text(d.abyss),$("#lucky > div").css("background-image",`url('https://img-api.neople.co.kr/df/servers/${l.serverId}/characters/${l.characterId}?zoom=1')`),$("#lucky > div").addClass(l.jobCss),$("#lk_name").text(l.characterName),$("#lk_name").on("click",e=>{let a=`https://dfgear.xyz/character?sId=${l.serverId}&cId=${l.characterId}&cName=${l.characterName}`;window.open(a,"_self")}),d.begin+d.legacy>0&&(0==d.epic?$("#b_rate").text("(1.00)"):$("#b_rate").text(`(${((d.begin+d.legacy-d.potB-d.potLB)/d.epic).toFixed(3)})`)),$("#channels > div").remove(),e.channel&&e.channel.length>0)for(var i of($("#channels").removeClass("hidden"),e.channel=e.channel.slice(0,5),e.channel))$("#channels").append(`<div><h4 id="ch1">${i.cn}</h4><h5 id="ch1cnt">${i.cnt}개</h5></div>`);else $("#channels").addClass("hidden")}catch(e){console.error(e)}makeCardView(e.rows[0]),loadingToggle(!1)}function adventureDetail(e){try{callGearAPI("/adventure/detail/"+adventureName,{id:adventureName},e)}catch(e){sessionStorage.clear(),console.log(e)}}function set_List(e){try{[...e.timeline,...e.reroll||[]].forEach((e,a)=>{if(e.setItemName){const a=$(`div.b-태초[data-id="${e.itemId}"]`);null==setList[e.itemId]?(setList[e.itemId]={cnt:1,list:[e]},a.addClass("on"),a.append('<span class="itemCount"></span>')):(setList[e.itemId].cnt++,setList[e.itemId].list.push(e),a.children("span").text("x"+setList[e.itemId].cnt))}})}catch(e){console.error(e)}}function viewList(e,a,t="",s="",n=!1){try{const d=$(`#${e}`);if(d){n&&d.children().remove();let e=`<div class="card-header ${s}">${t}</div><ul class="list-group list-group-flush">`,i=0;a.forEach((a,t)=>{let s="",d="",l=!0,r=n?`, <span class="smallword">${moment(a.date).format("YYYY-MM-DD HH:mm")}</span>`:"";a.sp&&(s="abyss"),a.advtIn&&"in"==a.advtIn?(i++,d="advt-in",r+=' <span class="badge bg-warning rounded-pill">초월보냄</span>'):504==a.code?(i++,r+=' <span class="badge bg-warning rounded-pill dv-list">항아리&상자</span>'):507==a.code?(i++,r+=` <span class="badge bg-warning rounded-pill" title="${a.channel}">레이드</span>`):510==a.code?(i++,r+=' <span class="badge bg-warning rounded-pill">교환</span>'):511==a.code?(i++,r+=' <span class="badge bg-warning rounded-pill">승급</span>'):513==a.code?(i++,r+=` <span class="badge bg-warning rounded-pill" title="${a.channel}">카드</span>`):514==a.code?(l=!1,r+=' <span class="badge bg-warning rounded-pill">리롤/제작서</span>'):515==a.code||516==a.code?(l=!1,r+=' <span class="badge bg-warning rounded-pill">초월</span>'):519==a.code?(i++,r+=' <span class="badge bg-warning rounded-pill">변환</span>'):520==a.code&&(i++,r+=' <span class="badge bg-warning rounded-pill">제작</span>'),e+=`<li class="list-group-item dv-list ${s}" title="${moment(a.date).format("YYYY-MM-DD HH:mm")}">\n        <dd>${l?i:"-"}</dd>\n        <div class="smallIcon ${a.jobCss}" style="background-image: url('https://img-api.neople.co.kr/df/servers/${a.serverId}/characters/${a.characterId}?zoom=1');"></div>\n        <p class="${d}" tabindex="0" data-title="${moment(a.date).format("YYYY-MM-DD HH:mm")}${505!=a.code?", "+a.channel:""}"><img src="https://img-api.neople.co.kr/df/items/${a.itemId}">${a.itemName}</p>`,e+=r}),e+="</li></ul>",d.append(e)}}catch(e){console.error(e)}}$(document).ready(function(){$(document).on("click","#btn_lightmode",function(e){ligthModeChange(e.target)}),$(document).on("click",".row.title",function(){try{location.href="./"}catch(e){sessionStorage.clear(),location.href="https://dfgear.xyz"}}),$(document).on("click",".potList",function(){$(".card-header.potList").hasClass("open")?($(".card-header.potList").removeClass("open"),$("ul.pots").removeClass("show")):($(".card-header.potList").addClass("open"),$("ul.pots").addClass("show"))}),$(document).on("click","#aName",function(e){return sessionStorage.setItem("sId","adventure"),sessionStorage.setItem("cName",$(e.target).text()),location.href=`https://dfgear.xyz/adventure?cName=${encodeURIComponent($(e.target).text())}`}),$(window).resize(function(){$("#loadingScreen").css("height",$(document).height())});try{adventureName=sessionStorage.getItem("advtNM")?sessionStorage.getItem("advtNM"):new URLSearchParams(location.search).get("name"),""==adventureName||null===adventureName?(alert("모험단 정보를 다시 선택해주세요"),sessionStorage.clear(),location.href="https://dfgear.xyz/adventure"):Search()}catch(e){alert("모험단 정보를 다시 선택해주세요"),sessionStorage.clear(),location.href="https://dfgear.xyz/adventure"}$("#setItem .flgap > div").on("click",function(e){try{let a;const t=$(e.target);if(t.is("img")){const e=t.closest("div");if(!e.hasClass("on"))return;{a=e.attr("data-id");let t=e.attr("title");if(recentItem!=a){viewList("itemGetList",setList[a].list,t,"",!0),recentItem=a}}}else{if(!t.hasClass("on"))return;{a=t.attr("data-id");let e=t.attr("title");if(recentItem!=a){viewList("itemGetList",setList[a].list,e,"",!0),recentItem=a}}}}catch(e){console.error(e)}}),$("#itemFilter").on("input",function(){clearTimeout(debounceTimer);const e=$("#mistList ul.list-group-flush"),a=$(this).val();debounceTimer=setTimeout(function(){filterSpan(e,a)},400)}),$(document).on("click","#ft_pot",function(e){$(this).is(":checked")?($(".dv-list").addClass("hidden"),$(".dv-pot").removeClass("hidden")):($(".dv-pot").addClass("hidden"),$(".dv-list").removeClass("hidden"))})});