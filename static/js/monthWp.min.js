let nowDate=moment().format("YYYYMMDDTHHmm"),apioff=!1,recentItem=null,locationList={},lastUpdate={};function drawChart(t){try{if($(".is-show").addClass("hidden"),"notToday"===t.item)return apioff=!0,void toast("info","해당 기능은 월초에만 이용할 수 있습니다.");if(t.item.length>0){$("#notData").addClass("hidden");let e=0;if(t.item.forEach((t,a)=>{$(`#wp${a}`).attr("title",t.itemNm),$(`#wp${a}`).removeClass("hidden"),$(`#wpimg${a}`).attr("src",`https://img-api.neople.co.kr/df/items/${t.itemId}`),e+=t.cnt}),t.item[0].cnt){let a=(t.item[0].cnt/e*100).toFixed(0);$("#bar0").css("width",`${a}%`).removeClass("hidden"),$("#bar0").text(`${t.item[0].cnt}개`),t.item[0].lg?$("#bar0").addClass("legacy"):$("#bar0").removeClass("legacy")}if(t.item[1].cnt){let a=(t.item[1].cnt/e*100).toFixed(0);$("#bar1").css("width",`${a}%`).removeClass("hidden"),$("#bar1").text(`${t.item[1].cnt}개`),t.item[1].lg?$("#bar1").addClass("legacy"):$("#bar1").removeClass("legacy")}t.recent&&t.recent.itemNm?$("#recentLocation").text(`최근 획득 이력 : ${t.recent.itemNm} ${t.recent.channelName} ${t.recent.date}`).removeClass("hidden"):$("#recentLocation").addClass("hidden")}else $("#notData").removeClass("hidden")}catch(t){console.error(t)}}function loadingToggle(t=!0){t?($("#loadingScreen").css("height",$(document).height()),$("#loadingScreen").addClass("active"),$("#btn_search").addClass("disabled")):($("#loadingScreen").removeClass("active"),$("#btn_search").removeClass("disabled"))}function delayUpdate(t){return!!(lastUpdate[t]&&Date.now()-lastUpdate[t]<6e4)&&(locationList[t]&&drawChart(locationList[t]),!0)}$(document).ready(function(){if("0"===sessionStorage.getItem("serverState"))return toast("warning","DFGEAR 서버 점검");if($(document).on("click","#btn_lightmode",function(t){ligthModeChange(t.target)}),$(document).on("click",".row.title",function(){try{location.href="./"}catch(t){sessionStorage.clear(),location.href="https://dfgear.xyz"}}),$(window).resize(function(){$("#loadingScreen").css("height",$(document).height())}),!isBeginningOfMonth())return apioff=!0,void toast("info","해당 기능은 월초에만 이용할 수 있습니다.");function t(t){if(t)return apioff||"0"===sessionStorage.getItem("serverState")?toast("warning","DFGEAR 서버 점검"):void(delayUpdate(t)||(locationList[t]||(locationList[t]={item:[],recent:null}),function(t){if(!delayUpdate(t))apioff||"0"===sessionStorage.getItem("serverState")?toast("warning","DFGEAR 서버 점검"):$.ajax({url:api+"/item/monthWeaponPot",type:"get",timeout:3e4,processData:!0,beforeSend:function(t){loadingToggle(),t.setRequestHeader("Content-type","application/json;charset=UTF-8"),t.setRequestHeader("gear","dfgear")},data:{it:t},success:function(e,a,n){loadingToggle(!1),locationList[t]=e,drawChart(e)},error:function(t,e){if(loadingToggle(!1),!t.responseText)return console.log(e),console.log(t),alert("에러 발생");checkError(t.responseText)}})}(t),lastUpdate[t]=Date.now()));toast("info","아이템을 선택해주세요.")}$("#tab_job > div > button").on("click",function(t){$("#tab_job > div > button").removeClass("active"),$("#content_wp > div > div").removeClass("show"),$(t.target).addClass("active"),$(`#wp_${$(t.target).attr("data-cd")}`).addClass("show")}),$(".tabContent .flgap > div").on("click",function(e){try{let a;const n=$(e.target);if(n.is("button")){if(n.hasClass("active"))return;$(".tabContent .flgap > div button").removeClass("active"),n.addClass("active"),a=n.attr("data-cd")}else{const t=n.children("button");if(t.hasClass("active"))return;$(".tabContent .flgap > div button").removeClass("active"),t.addClass("active"),a=t.attr("data-cd")}recentItem||($("#weaponChart").addClass("show"),$("#txt_itemName").addClass("show")),recentItem=a,t(a)}catch(t){console.error(t)}}),$(document).on("click","#locationRefresh",function(){delayUpdate(recentItem)?toast("info","해당 무기는 1분 이내에 갱신되었습니다."):t(recentItem)})});